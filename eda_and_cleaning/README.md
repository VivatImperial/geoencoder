# EDA и очистка датасета адресов

Модуль выполняет анализ и отсев неполных или некорректных адресов перед обучением геокодера.

## Запуск

Скрипт запускается из корня репозитория:
```bash
uv run python eda_and_cleaning/analyze_addresses.py --csv data/addresses_spb.csv --out-dir eda_and_cleaning
```
Опции: `--out-dir`, `--cleaned-csv` (имя файла очищенного CSV в каталоге).

## Выходные файлы

- **report.md** — отчёт: число отсеянных записей, причины отсева, примеры.
- **summary.json** — сводка и примеры по каждой причине.
- **addresses_spb_cleaned.csv** — датасет после очистки (только записи, прошедшие правила).
- **dropped_examples.json** — примеры отсеянных записей с указанием причины.

## Правила отсева (geocoding.cleaning)

| Причина | Описание |
|--------|----------|
| `too_short` | Длина адреса < 5 символов |
| `number_range_only` | Только цифры, дефисы, точки с запятой (диапазоны квартир и т.п.) |
| `invalid_placeholder` | Содержит fixme, todo, unknown и т.п. |
| `ru_only_or_ru_plus_one` | Первая часть — «RU», частей не больше двух (страна или страна + город/регион без улицы) |
| `ru_postcode_only` | Формат «RU, 123456» |
| `no_digit` | Нет ни одной цифры (нет номера дома) |
| `more_digits_than_letters` | В адресе больше цифр, чем букв |

## Связь с пайплайном обучения

При загрузке CSV в обучении (`geocoding.data.load_csv`) те же правила применяются автоматически; не прошедшие их адреса не попадают в train/val/test. Очищенный CSV можно передавать в обучение напрямую (`--csv eda_and_cleaning/addresses_spb_cleaned.csv`); при этом фильтр при загрузке дополнительно ничего не отсеет.
